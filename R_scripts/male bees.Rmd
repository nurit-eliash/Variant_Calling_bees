---
title: "explore male bees"
author: "Nurit Eliash"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### load libraries
```{r}
library("tidyverse")
library("dplyr")
library("ggplot2")
library("ggpubr")
library("scales")
library("ggpubr")
library("gridExtra")
library("grid")
library("GGally")
```

### Heterozygosity and inbreeding coefficient per individual
```{r}

```

### Heterozygosity and inbreeding coefficient per individual
```{r}
ind_het <- read_delim("/Users/nuriteliash/Documents/GitHub/VariantCall_bees/data/vcf_stats/bee.het", delim = "\t",
           col_names = c("ind","homo_ob", "homo_ex", "nsites", "f"), skip = 1)

# add the sex of each sample, and the proportion of homosyzgotic and hetero sites
sex <- read.csv("/Users/nuriteliash/Documents/GitHub/VariantCall_bees/data/meta.csv")
ind_het <- left_join(ind_het,sex, by ="ind") %>%
  mutate(hom_prop =  homo_ob/nsites) %>%
  mutate(het_prop = (nsites-homo_ob)/nsites)
 
#plot inbreeding coefficient per individual
ggplot(ind_het, aes(f, fill = sex)) + geom_histogram(color = "black") + 
  theme_light() +
  ggtitle("Inbreeding coefficient per individual")

# plot heterozygosity proportion, in each sex
ggplot(ind_het) +
    geom_boxplot(aes(x = sex, y = het_prop, fill = sex)) + scale_y_continuous() + 
    theme_classic() +
    ggtitle("Proportion of heterzygotic sites in bees")

# is there a significant difference in the proportion of heterozygotic sites between males and females?5
test <- ind_het %>%
  filter(sex == c("female", "male"))

wilcox.test(het_prop ~ sex, alternative = "two.sided", data = test)
t.test(asin(sqrt(het_prop)) ~ sex, alternative = "two.sided", data = test)

# no significant different (both wilcoxone and welch-test)
```

plot heterozygosity 
```{r}
# plot heterozygosity proportion, in each individual, color code by sex
ggplot(ind_het, aes(x=ind, y=het_prop, color=sex)) + 
    geom_point(size=3) +
    theme_classic() +
    ggtitle("Proportion of heterzygotic sites per bee") +
    xlab("Sample") + 
    ylab("Proportion of het zites")
```

### Heterozygosity per site
--hardy

Reports a p-value for each site from a Hardy-Weinberg Equilibrium test (as defined by Wigginton, Cutler and Abecasis (2005)). The resulting file (with suffix ".hwe") also contains the Observed numbers of Homozygotes and Heterozygotes and the corresponding Expected numbers under HWE.
#### for all individuals
```{r}
site_hwe <- read_delim("/Users/nuriteliash/Documents/GitHub/Snakemake_bees/data/vcf_stats/Q40BIALLDP16_40mis.5maf0.2Chr7.hwe", delim = "\t", col_names = c("CHR","POS", "OBS(HOM1/HET/HOM2)", "E(HOM1/HET/HOM2)", "ChiSq_HWE", "P_HWE", "P_HET_DEFICIT", "P_HET_EXCESS"), skip = 1)

site_het <- site_hwe %>%
  select(CHR, POS, "OBS(HOM1/HET/HOM2)") %>%
  separate(col = "OBS(HOM1/HET/HOM2)", into = c("hom1", "het", "hom2"), sep = "\\/") %>%
  mutate_at(c("hom1", "het", "hom2"), as.numeric) %>%
  mutate(prop_het = (het/(hom1+ het+ hom2)))

site_het <-  mutate(site_het, site = paste(site_het$CHR, site_het$POS)) 
  
ggplot(site_het, aes(prop_het)) + geom_histogram(fill="#69b3a2", color="#e9ecef", alpha=0.8) + 
  theme_light() +
  ggtitle("Heterozygosity per site- all individuals")+
  xlab("Proportion of het genotype") + 
  ylab("Number of sites")
```
